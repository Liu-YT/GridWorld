webpackJsonp([265],{1905:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),r=n(2528),i=n(135),s=n(10),a=function(e){return{currentUser:Object(s.getCurrentUser)(e)}},l=function(e){return{onRequestFail:Object(i.g)(e)}};t.default=Object(o.connect)(a,l)(r.a)},2528:function(e,t,n){"use strict";function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),l=n.n(a),c=n(24),p=n.n(c),u=n(5),m=(n.n(u),n(2529)),f=n(356),d=n(878),h=n(2530),g=n(2531),b=n(875),y=n(55),v=n(2),P=n(355),j=(n.n(P),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),_=l.a.createElement(b.a,null),O=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.stopLoading=function(){n.mounted&&n.setState({loading:!1})},n.loadHolders=function(){if(n.mounted){n.setState({loading:!0});var e=n.props.component,t=n.state,o=t.filter,r=t.query,i=t.selectedPermission,s="groups"!==o?y.m(e.key,r,i,e.organization):Promise.resolve([]),a="users"!==o?y.l(e.key,r,i,e.organization):Promise.resolve([]);Promise.all([s,a]).then(function(e){n.mounted&&n.setState({loading:!1,groups:e[1],users:e[0]})},function(e){n.mounted&&(n.props.onRequestFail(e),n.setState({loading:!1}))})}},n.handleFilterChange=function(e){n.mounted&&n.setState({filter:e},n.loadHolders)},n.handleQueryChange=function(e){n.mounted&&n.setState({query:e},n.loadHolders)},n.handlePermissionSelect=function(e){n.mounted&&n.setState(function(t){return{selectedPermission:t.selectedPermission===e?void 0:e}},n.loadHolders)},n.addPermissionToGroup=function(e,t){return n.state.groups.map(function(n){return n.name===e?Object.assign({},n,{permissions:[].concat(o(n.permissions),[t])}):n})},n.addPermissionToUser=function(e,t){return n.state.users.map(function(n){return n.login===e?Object.assign({},n,{permissions:[].concat(o(n.permissions),[t])}):n})},n.removePermissionFromGroup=function(e,t){return n.state.groups.map(function(n){return n.name===e?Object.assign({},n,{permissions:Object(u.without)(n.permissions,t)}):n})},n.removePermissionFromUser=function(e,t){return n.state.users.map(function(n){return n.login===e?Object.assign({},n,{permissions:Object(u.without)(n.permissions,t)}):n})},n.grantPermissionToGroup=function(e,t){n.mounted&&(n.setState({loading:!0,groups:n.addPermissionToGroup(e,t)}),y.n(n.props.component.key,e,t,n.props.component.organization).then(n.stopLoading,function(o){n.mounted&&(n.setState({loading:!1,groups:n.removePermissionFromGroup(e,t)}),n.props.onRequestFail(o))}))},n.grantPermissionToUser=function(e,t){n.mounted&&(n.setState({loading:!0,users:n.addPermissionToUser(e,t)}),y.o(n.props.component.key,e,t,n.props.component.organization).then(n.stopLoading,function(o){n.mounted&&(n.setState({loading:!1,users:n.removePermissionFromUser(e,t)}),n.props.onRequestFail(o))}))},n.revokePermissionFromGroup=function(e,t){n.mounted&&(n.setState({loading:!0,groups:n.removePermissionFromGroup(e,t)}),y.s(n.props.component.key,e,t,n.props.component.organization).then(n.stopLoading,function(o){n.mounted&&(n.setState({loading:!1,groups:n.addPermissionToGroup(e,t)}),n.props.onRequestFail(o))}))},n.revokePermissionFromUser=function(e,t){n.mounted&&(n.setState({loading:!0,users:n.removePermissionFromUser(e,t)}),y.t(n.props.component.key,e,t,n.props.component.organization).then(n.stopLoading,function(o){n.mounted&&(n.setState({loading:!1,users:n.addPermissionToUser(e,t)}),n.props.onRequestFail(o))}))},n.handleVisibilityChange=function(e){"public"===e?n.openDisclaimer():n.turnProjectToPrivate()},n.turnProjectToPublic=function(){n.props.onComponentChange({visibility:"public"}),y.d(n.props.component.key,"public").then(function(){n.loadHolders()},function(e){n.props.onComponentChange({visibility:"private"}),n.props.onRequestFail(e)})},n.turnProjectToPrivate=function(){n.props.onComponentChange({visibility:"private"}),y.d(n.props.component.key,"private").then(function(){n.loadHolders()},function(e){n.props.onComponentChange({visibility:"public"}),n.props.onRequestFail(e)})},n.openDisclaimer=function(){n.mounted&&n.setState({disclaimer:!0})},n.closeDisclaimer=function(){n.mounted&&n.setState({disclaimer:!1})},n.state={disclaimer:!1,filter:"all",groups:[],loading:!0,query:"",users:[]},n}return s(t,e),j(t,[{key:"componentDidMount",value:function(){this.mounted=!0,this.loadHolders()}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var e=null!=this.props.component.configuration&&this.props.component.configuration.canUpdateProjectVisibilityToPrivate;return l.a.createElement("div",{className:"page page-limited",id:"project-permissions-page"},l.a.createElement(p.a,{title:Object(v.translate)("permissions.page")}),l.a.createElement(m.a,{component:this.props.component,loading:this.state.loading,loadHolders:this.loadHolders}),_,l.a.createElement("div",null,l.a.createElement(d.a,{canTurnToPrivate:e,className:"big-spacer-top big-spacer-bottom",onChange:this.handleVisibilityChange,visibility:this.props.component.visibility}),"TRK"===this.props.component.qualifier&&!e&&l.a.createElement(f.a,{organization:this.props.component.organization}),this.state.disclaimer&&l.a.createElement(g.a,{component:this.props.component,onClose:this.closeDisclaimer,onConfirm:this.turnProjectToPublic})),l.a.createElement(h.a,{component:this.props.component,filter:this.state.filter,grantPermissionToGroup:this.grantPermissionToGroup,grantPermissionToUser:this.grantPermissionToUser,groups:this.state.groups,onFilterChange:this.handleFilterChange,onPermissionSelect:this.handlePermissionSelect,onQueryChange:this.handleQueryChange,query:this.state.query,revokePermissionFromGroup:this.revokePermissionFromGroup,revokePermissionFromUser:this.revokePermissionFromUser,selectedPermission:this.state.selectedPermission,visibility:this.props.component.visibility,users:this.state.users}))}}]),t}(l.a.PureComponent);t.a=O},2529:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=n(0),a=n.n(s),l=n(2),c=n(877),p=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=a.a.createElement("i",{className:"spinner"}),m=function(e){function t(){var e,n,i,s;o(this,t);for(var a=arguments.length,l=Array(a),p=0;p<a;p++)l[p]=arguments[p];return n=i=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),i.handleApplyTemplate=function(e){e.preventDefault(),e.target.blur();var t=i.props,n=t.component,o=t.loadHolders,r=n.organization?{key:n.organization}:null;new c.a({project:n,organization:r}).on("done",function(){return o()}).render()},s=n,r(i,s)}return i(t,e),p(t,[{key:"render",value:function(){var e=this.props.component,t=e.configuration,n=null!=t&&t.canApplyPermissionTemplate,o=["VW","SVW","APP"].includes(e.qualifier)?Object(l.translate)("roles.page.description_portfolio"):Object(l.translate)("roles.page.description2"),r="TRK"===e.qualifier?Object(l.translate)("visibility",e.visibility,"description"):null;return a.a.createElement("header",{className:"page-header"},a.a.createElement("h1",{className:"page-title"},Object(l.translate)("permissions.page")),this.props.loading&&u,n&&a.a.createElement("div",{className:"page-actions"},a.a.createElement("button",{className:"js-apply-template",onClick:this.handleApplyTemplate},Object(l.translate)("projects_role.apply_template"))),a.a.createElement("div",{className:"page-description"},a.a.createElement("p",null,o),null!=r&&a.a.createElement("p",null,r)))}}]),t}(a.a.PureComponent);t.a=m},2530:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=n(0),a=n.n(s),l=n(5),c=(n.n(l),n(353)),p=n(354),u=n(2),m=n(876),f=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),d=function(e){function t(){var e,n,i,s;o(this,t);for(var a=arguments.length,l=Array(a),c=0;c<a;c++)l[c]=arguments[c];return n=i=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),i.handleToggleUser=function(e,t){e.permissions.includes(t)?i.props.revokePermissionFromUser(e.login,t):i.props.grantPermissionToUser(e.login,t)},i.handleToggleGroup=function(e,t){e.permissions.includes(t)?i.props.revokePermissionFromGroup(e.name,t):i.props.grantPermissionToGroup(e.name,t)},i.handleSelectPermission=function(e){i.props.onPermissionSelect(e)},s=n,r(i,s)}return i(t,e),f(t,[{key:"render",value:function(){var e=m.a[this.props.component.qualifier];"public"===this.props.visibility&&(e=Object(l.without)(e,"user","codeviewer"));var t=e.map(function(e){return{key:e,name:Object(u.translate)("projects_role",e),description:Object(u.translate)("projects_role",e,"desc")}});return a.a.createElement(p.a,{permissions:t,selectedPermission:this.props.selectedPermission,users:this.props.users,groups:this.props.groups,onSelectPermission:this.handleSelectPermission,onToggleUser:this.handleToggleUser,onToggleGroup:this.handleToggleGroup},a.a.createElement(c.a,{query:this.props.query,filter:this.props.filter,onSearch:this.props.onQueryChange,onFilter:this.props.onFilterChange}))}}]),t}(a.a.PureComponent);t.a=d},2531:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=n(0),a=n.n(s),l=n(27),c=n(2),p=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=function(e){function t(){var e,n,i,s;o(this,t);for(var a=arguments.length,l=Array(a),c=0;c<a;c++)l[c]=arguments[c];return n=i=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),i.handleCancelClick=function(e){e.preventDefault(),i.props.onClose()},i.handleConfirmClick=function(e){e.preventDefault(),i.props.onConfirm(),i.props.onClose()},s=n,r(i,s)}return i(t,e),p(t,[{key:"render",value:function(){var e=this.props.component.qualifier;return a.a.createElement(l.a,{contentLabel:"modal form",onRequestClose:this.props.onClose},a.a.createElement("header",{className:"modal-head"},a.a.createElement("h2",null,Object(c.translateWithParameters)("projects_role.turn_x_to_public",this.props.component.name))),a.a.createElement("div",{className:"modal-body"},a.a.createElement("p",null,Object(c.translate)("projects_role.are_you_sure_to_turn_project_to_public",e)),a.a.createElement("p",{className:"spacer-top"},Object(c.translate)("projects_role.are_you_sure_to_turn_project_to_public.2",e))),a.a.createElement("footer",{className:"modal-foot"},a.a.createElement("button",{id:"confirm-turn-to-public",onClick:this.handleConfirmClick},Object(c.translate)("projects_role.turn_project_to_public",e)),a.a.createElement("a",{href:"#",onClick:this.handleCancelClick},Object(c.translate)("cancel"))))}}]),t}(a.a.PureComponent);t.a=u}});
//# sourceMappingURL=265.bf7b5393.chunk.js.map